## Playbook to install postgresql 9.6 from the offical postgres (pgdg) repo using `geerlingguy.postgresql` role
# The role is expected to be in a configured role path (usually added via git submodule)
# Note: The target server host should not run selinux (in mode enforcing), as this might create issues
- hosts: all
  gather_facts: true
  become: yes

  pre_tasks:
    #TODO: Make the repo installation optional (in case we do an offline install)
    - name: install PostgreSQL 9.6 repository
      yum:
        name: https://download.postgresql.org/pub/repos/yum/9.6/redhat/rhel-7-x86_64/pgdg-centos96-9.6-3.noarch.rpm
        state: present

  roles:
    #- name: geerlingguy.postgresql
    - name: ansible-role-postgresql
      postgresql_enablerepo: "pgdg96"
      postgresql_version: 9.6
      postgresql_data_dir: /var/lib/pgsql/9.6/data
      postgresql_bin_path: /usr/pgsql-9.6/bin
      postgresql_config_path: /var/lib/pgsql/9.6/data
      postgresql_daemon: postgresql-9.6.service
      postgresql_packages:
        - postgresql96
        - postgresql96-server
        - postgresql96-libs
        - postgresql96-contrib
        - postgresql96-devel
      postgresql_global_config_options:
        - option: listen_addresses
          value: "*"
        - option: max_connections
          value: "500" 
      # Important, set following empty, so the role skips its pg_hba.conf task (which by default resets that conf)
      postgresql_hba_entries: []
